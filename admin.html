<!doctype html>
<html lang="nb">
<head>
  <meta charset="utf-8" />
  <title>FjOlsenbanden – Adminpanel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --------------------------------------------------
     *  FARGER & VARIABLER
     * -------------------------------------------------- */
    :root {
      --bg: #050b2b;
      --bg-alt: #071133;
      --card: #0d1636;
      --card-alt: #101a3e;
      --text: #ffffff;
      --muted: #a6b0d8;
      --primary: #00a6ff;
      --accent: #ff2da4;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 24px 60px rgba(0, 0, 0, 0.65);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101a3e 0, #050b2b 50%, #020317 100%);
      color: var(--text);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* --------------------------------------------------
     *  TOPP & LAYOUT
     * -------------------------------------------------- */

    .top-bar {
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(5, 11, 43, 0.97);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .top-bar-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .top-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .top-brand img {
      height: 32px;
    }

    .top-title {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .top-title-main {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .top-title-sub {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .top-badge {
      padding: 0.25rem 0.9rem;
      border-radius: var(--radius-pill);
      background: rgba(0, 166, 255, 0.18);
      color: #b9e5ff;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    /* Layout */

    .page-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.75rem 1.5rem 3rem;
      display: grid;
      grid-template-columns: 220px minmax(0, 1fr);
      gap: 1.5rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .page-shell {
        grid-template-columns: 1fr;
      }
    }

    .page-main-header {
      grid-column: 1 / -1;
      margin-bottom: 0.5rem;
    }

    .page-main-header h1 {
      font-size: clamp(2rem, 3vw, 2.4rem);
      margin: 0 0 0.35rem;
    }

    .page-main-header p {
      margin: 0;
      color: var(--muted);
      max-width: 640px;
      font-size: 0.95rem;
    }

    .card {
      background: radial-gradient(circle at top left, var(--card-alt), var(--card));
      border-radius: var(--radius-lg);
      padding: 1.5rem 1.6rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    /* --------------------------------------------------
     *  SIDE-NAV
     * -------------------------------------------------- */

    .admin-nav {
      position: sticky;
      top: 4.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      padding: 1rem 1rem;
      border-radius: 20px;
      background: radial-gradient(circle at top left, #151f4b, #050b2b);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: var(--shadow-soft);
    }

    .admin-nav-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .admin-nav-btn {
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 0.85rem;
      text-align: left;
      padding: 0.35rem 0.65rem;
      border-radius: 999px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .admin-nav-btn span {
      flex: 1;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .admin-nav-btn:hover {
      background: rgba(255, 255, 255, 0.06);
      color: #ffffff;
    }

    .admin-nav-btn.active {
      background: rgba(0, 166, 255, 0.25);
      color: #ffffff;
    }

    @media (max-width: 900px) {
      .admin-nav {
        position: static;
        flex-direction: row;
        flex-wrap: wrap;
        row-gap: 0.5rem;
      }
    }

    .admin-nav-section {
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      padding-top: 0.35rem;
      margin-top: 0.35rem;
    }

    /* --------------------------------------------------
     *  HOVEDINNHOLD
     * -------------------------------------------------- */

    .main-column {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: rgba(2, 4, 25, 0.7);
      border-radius: 18px;
      padding: 0.9rem 1rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .stat-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      margin-top: 0.35rem;
      padding: 0.1rem 0.6rem;
      border-radius: var(--radius-pill);
      font-size: 0.75rem;
      background: rgba(0, 166, 255, 0.12);
      color: #b9e5ff;
    }

    .stat-pill--off {
      background: rgba(255, 45, 164, 0.16);
      color: #ffc4e2;
    }

    .section-list,
    .settings-stack {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* --------------------------------------------------
     *  SEKSJONS-SORTERING
     * -------------------------------------------------- */

    .section-sorter {
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 18px;
      padding: 1rem;
      background: rgba(7, 17, 48, 0.8);
    }

    .section-sorter-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .section-sorter-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .section-sorter-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.75rem;
      padding: 0.7rem 0.9rem;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      cursor: grab;
    }

    .section-sorter-item.dragging {
      opacity: 0.6;
      border-style: dashed;
    }

    .sorter-handle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
      font-weight: 700;
    }

    .sorter-name {
      font-weight: 600;
    }

    .sorter-tag {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .section-card {
      background: radial-gradient(circle at top left, #192554, #0b1433);
      border-radius: 22px;
      padding: 1.25rem 1.4rem 1.2rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      scroll-margin-top: 90px;
    }

    .section-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .section-header-main {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .section-label {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .section-id {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .section-tag {
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.06);
      color: var(--muted);
      white-space: nowrap;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.85rem;
      color: var(--muted);
      cursor: pointer;
      white-space: nowrap;
    }

    .toggle input {
      accent-color: var(--primary);
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.6rem;
    }

    .field-group label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .field-group input,
    .field-group textarea {
      background: #070f2c;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.6rem 0.75rem;
      color: var(--text);
      font: inherit;
    }

    .field-group textarea {
      min-height: 70px;
      resize: vertical;
    }

    .field-group input:focus,
    .field-group textarea:focus {
      outline: 2px solid var(--primary);
      outline-offset: 1px;
    }

    .field-inline {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 0.75rem;
    }

    @media (max-width: 700px) {
      .field-inline {
        grid-template-columns: 1fr;
      }
    }

    .subsection-title {
      margin-top: 0.9rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .small-hint {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    .two-column-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem 1rem;
      margin-top: 0.5rem;
    }

    .two-column-fields .field-group {
      margin-top: 0;
    }

    .feedback-grid-admin {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .feedback-item-admin {
      background: rgba(2, 4, 25, 0.6);
      border-radius: 14px;
      padding: 0.75rem 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .feedback-item-admin-header {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }

    .actions {
      margin-top: 1.25rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.7rem 1.6rem;
      border-radius: var(--radius-pill);
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 0 18px rgba(0, 166, 255, 0.45);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--muted);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .btn-ghost:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .status {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .status--ok {
      color: #63e6a5;
    }

    .status--error {
      color: #ff7a7a;
    }

    /* Right column / global settings & info */

    .info-stack {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .info-card-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .info-card p {
      margin: 0 0 0.35rem;
      font-size: 0.86rem;
      color: var(--muted);
    }

    .info-key {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
        monospace;
      font-size: 0.8rem;
      background: rgba(2, 4, 25, 0.9);
      padding: 0.35rem 0.6rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: inline-block;
      margin-top: 0.25rem;
      word-break: break-all;
    }

    .global-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .global-row {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .global-label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .global-input {
      background: #070f2c;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.6rem 0.75rem;
      color: var(--text);
      font: inherit;
    }

    .global-input:focus {
      outline: 2px solid var(--primary);
      outline-offset: 1px;
    }

    .global-help {
      font-size: 0.78rem;
      color: var(--muted);
    }

    /* Login overlay */

    .auth-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(16, 26, 90, 0.95), rgba(2, 3, 20, 0.98));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .auth-box {
      width: 100%;
      max-width: 360px;
      background: radial-gradient(circle at top left, #151f4b, #050b2b);
      border-radius: 24px;
      padding: 1.8rem 1.7rem 1.5rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .auth-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .auth-logo img {
      height: 32px;
    }

    .auth-title {
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 0.3rem;
    }

    .auth-sub {
      font-size: 0.85rem;
      text-align: center;
      color: var(--muted);
      margin-bottom: 1.1rem;
    }

    .auth-field {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-bottom: 0.9rem;
    }

    .auth-field label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .auth-field input {
      background: #070f2c;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.6rem 0.75rem;
      color: var(--text);
      font: inherit;
    }

    .auth-field input:focus {
      outline: 2px solid var(--primary);
      outline-offset: 1px;
    }

    .auth-error {
      min-height: 1.1rem;
      font-size: 0.8rem;
      color: #ff7a7a;
      margin-bottom: 0.4rem;
      text-align: center;
    }

    .auth-actions {
      display: flex;
      justify-content: center;
      margin-top: 0.5rem;
    }

    .auth-btn {
      width: 100%;
      justify-content: center;
    }

    .app {
      opacity: 0;
      pointer-events: none;
      transform: translateY(4px);
      transition: opacity 0.18s ease, transform 0.18s ease;
    }

    .app--ready {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    @media (max-width: 600px) {
      .top-bar-inner {
        padding-inline: 1rem;
      }
      .page-shell {
        padding-inline: 1rem;
      }
    }

    /* Vipps module */
    .vipps-card {
      display: grid;
      gap: 0.8rem;
    }

    .vipps-card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
    }

    .vipps-grid {
      display: grid;
      gap: 0.85rem;
    }

    .vipps-label {
      display: grid;
      gap: 0.35rem;
      font-size: 0.95rem;
      color: #ffffff;
    }

    .vipps-input,
    .vipps-card input[type="password"] {
      width: 100%;
      padding: 0.75rem 0.85rem;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.05);
      color: #ffffff;
      font: inherit;
    }

    .vipps-input::placeholder,
    .vipps-card input[type="password"]::placeholder {
      color: rgba(255, 255, 255, 0.45);
    }

    .vipps-toggle {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 600;
      color: #ffffff;
    }

    .vipps-status-message {
      min-height: 1.1rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .vipps-status-message.status--ok {
      color: #7bffca;
    }

    .vipps-status-message.status--error {
      color: #ff7a7a;
    }
  </style>
</head>
<body>
  <!-- Login overlay -->
  <div class="auth-overlay" id="auth-overlay">
    <div class="auth-box">
      <div class="auth-logo">
        <img src="https://setaei.com/Fjolsen/Liggende-M%E2%94%9C%E2%95%95rk.png" alt="FjOlsenbanden logo" />
      </div>
      <div class="auth-title">Admin tilgang</div>
      <div class="auth-sub">Skriv inn access pass for å åpne adminpanelet.</div>

      <form id="auth-form">
        <div class="auth-field">
          <label for="access-pass">Access pass</label>
          <input type="password" id="access-pass" autocomplete="off" />
        </div>
        <div class="auth-error" id="auth-error"></div>
        <div class="auth-actions">
          <button type="submit" class="btn btn-primary auth-btn">Logg inn</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Top bar -->
  <div class="top-bar">
    <div class="top-bar-inner">
      <div class="top-brand">
        <img src="https://setaei.com/Fjolsen/Liggende-M%E2%94%9C%E2%95%95rk.png" alt="FjOlsenbanden logo" />
        <div class="top-title">
          <span class="top-title-main">FjOlsenbanden – Adminpanel</span>
          <span class="top-title-sub">Styr seksjoner og innhold som vises på forsiden</span>
        </div>
      </div>
      <span class="top-badge">Admin</span>
    </div>
  </div>

  <main class="app" id="app">
    <div class="page-shell">
      <header class="page-main-header">
        <h1>Forsideoppsett</h1>
        <p>
          Aktiver eller deaktiver seksjoner, tilpass innhold direkte under hver seksjon, og oppdater logo, video og
          sosiale lenker. Endringer lagres i nettleseren (localStorage) og brukes av forsiden (<code>index.html</code>).
        </p>
      </header>

      <!-- Side-nav -->
      <aside class="admin-nav">
        <div class="admin-nav-title">Seksjoner</div>
        <button class="admin-nav-btn" data-target="section-sorter"><span>Seksjonsliste</span></button>
        <button class="admin-nav-btn" data-target="section-hero"><span>Hero / Velkommen</span></button>
        <button class="admin-nav-btn" data-target="section-community"><span>Community / SoMe</span></button>
        <button class="admin-nav-btn" data-target="section-julekalender"><span>Julekalender</span></button>
        <button class="admin-nav-btn" data-target="section-about"><span>Om FjOlsenbanden</span></button>
        <button class="admin-nav-btn" data-target="section-video"><span>Video / Hvem er FjOlsen</span></button>
        <button class="admin-nav-btn" data-target="section-feedback"><span>Tilbakemeldinger</span></button>
        <button class="admin-nav-btn" data-target="section-membership"><span>Medlemskap</span></button>
        <button class="admin-nav-btn" data-target="section-partners"><span>Partnere</span></button>
        <button class="admin-nav-btn" data-target="section-services"><span>Andre tilbud</span></button>
        <button class="admin-nav-btn" data-target="section-contact"><span>Kontakt</span></button>
        <button class="admin-nav-btn" data-target="section-faq"><span>FAQ</span></button>

        <div class="admin-nav-section">
          <div class="admin-nav-title">Innstillinger</div>
          <button class="admin-nav-btn" data-target="settings-access"><span>Access code</span></button>
          <button class="admin-nav-btn" data-target="settings-branding"><span>Logo & video</span></button>
          <button class="admin-nav-btn" data-target="settings-social"><span>Sosiale lenker</span></button>
          <button class="admin-nav-btn" data-target="admin-vipps-module"><span>Vipps / MobilePay</span></button>
        </div>
      </aside>

      <!-- Main content -->
      <div class="main-column">
        <section class="card" id="section-sorter">
          <div class="section-sorter">
            <div class="section-sorter-header">
              <div>
                <div class="section-label">Seksjonsliste</div>
                <div class="section-id">Dra for å endre rekkefølge. Slå på/av for å vise på forsiden.</div>
              </div>
              <span class="section-tag">Synk med forsiden</span>
            </div>
            <ol class="section-sorter-list" id="section-order-list"></ol>
          </div>
        </section>

        <section class="card">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Totalt seksjoner</div>
              <div class="stat-value" id="stat-total">–</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Aktive</div>
              <div class="stat-value" id="stat-on">–</div>
              <div class="stat-pill">Vises på forsiden</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Skjulte</div>
              <div class="stat-value" id="stat-off">–</div>
              <div class="stat-pill stat-pill--off">Skjult for besøkende</div>
            </div>
          </div>

          <div class="section-list" id="section-list">
            <!-- fylles av JS -->
          </div>

          <div class="actions">
            <button class="btn btn-primary" id="save-btn">Lagre innstillinger</button>
            <button class="btn btn-ghost" id="reset-btn">Tilbakestill til standard</button>
            <span class="status" id="status-msg"></span>
          </div>
          <div class="small-hint">
            Tips: åpne forsiden i en ny fane. Etter at du har lagret her, oppdaterer du forsiden (F5) for å se endringene.
          </div>
        </section>

        <section class="info-stack">
          <div class="card" id="settings-branding">
            <div class="info-card-title">Globale innstillinger</div>
            <div class="global-group">
              <div class="global-row">
                <span class="global-label">Logo URL</span>
                <input class="global-input" id="branding-logo" type="text" />
                <span class="global-help">Lenke til logo-bilde (PNG/SVG). Vises i header og footer.</span>
              </div>

              <div class="global-row">
                <span class="global-label">YouTube-video URL</span>
                <input class="global-input" id="branding-youtube" type="text" />
                <span class="global-help">
                  Kan være vanlig YouTube-lenke (watch eller youtu.be) – embed håndteres i forsiden.
                </span>
              </div>
            </div>
          </div>

          <div class="card" id="settings-social">
            <div class="info-card-title">Sosiale lenker</div>
            <div class="global-group">
              <div class="global-row">
                <span class="global-label">Twitch</span>
                <input class="global-input" id="social-twitch" type="text" />
              </div>
              <div class="global-row">
                <span class="global-label">TikTok</span>
                <input class="global-input" id="social-tiktok" type="text" />
              </div>
              <div class="global-row">
                <span class="global-label">Discord</span>
                <input class="global-input" id="social-discord" type="text" />
              </div>
              <div class="global-row">
                <span class="global-label">YouTube</span>
                <input class="global-input" id="social-youtube" type="text" />
              </div>
              <div class="global-row">
                <span class="global-label">Instagram</span>
                <input class="global-input" id="social-instagram" type="text" />
              </div>
              <span class="global-help">
                Disse lenkene brukes både i community-seksjonen og andre steder der du linker til SoMe-kanalene.
              </span>
            </div>
          </div>

          <div class="card info-card" id="settings-access">
            <div class="info-card-title">Tilgang & din info</div>
            <p>Oppdater koden som låser opp adminpanelet, og legg inn kontaktinfo.</p>
            <div class="global-group">
              <div class="global-row">
                <span class="global-label">Access code</span>
                <input class="global-input" id="access-code" type="password" placeholder="F.eks. 123456" />
                <span class="global-help">Koden må tastes inn når man åpner adminpanelet.</span>
              </div>
              <div class="global-row">
                <span class="global-label">Navn</span>
                <input class="global-input" id="admin-name" type="text" placeholder="Ditt navn" />
              </div>
              <div class="global-row">
                <span class="global-label">E-post</span>
                <input class="global-input" id="admin-email" type="email" placeholder="din@epost.no" />
              </div>
              <div class="global-row">
                <span class="global-label">Telefon</span>
                <input class="global-input" id="admin-phone" type="tel" placeholder="+47 ..." />
              </div>
            </div>
          </div>

          <div class="card vipps-card" id="admin-vipps-module">
            <div class="info-card-title">Vipps / MobilePay</div>
            <p class="admin-help-text">
              Legg inn opplysninger fra Vipps-portalen for å aktivere Vipps-modulen på forsiden.
            </p>

            <div class="vipps-grid">
              <label class="vipps-label">
                Merchant serial number (MSN)
                <input type="text" id="vipps-msn" class="vipps-input" placeholder="f.eks. 123456" />
              </label>

              <label class="vipps-label">
                Client ID
                <input type="text" id="vipps-client-id" class="vipps-input" placeholder="kopier fra Vipps-portalen" />
              </label>

              <label class="vipps-label">
                Client Secret
                <input type="password" id="vipps-client-secret" class="vipps-input" placeholder="kopier fra Vipps-portalen" />
              </label>

              <label class="vipps-label">
                Subscription key (API key)
                <input type="text" id="vipps-sub-key" class="vipps-input" placeholder="Ocp-Apim-Subscription-Key" />
              </label>

              <label class="vipps-toggle">
                <input type="checkbox" id="vipps-enabled" />
                <span>Aktiver Vipps-modulen på forsiden</span>
              </label>
            </div>

            <button id="vipps-save-settings" class="btn btn-primary">Lagre Vipps-innstillinger</button>
            <p id="vipps-status-message" class="vipps-status-message"></p>
          </div>

          <div class="card info-card">
            <div class="info-card-title">Hvordan fungerer dette?</div>
            <p>Alt lagres i <code>localStorage</code> under nøkkelen:</p>
            <div class="info-key">fjAdminConfig</div>
            <p>Forsiden leser dette når den lastes, og:</p>
            <p>• skjuler seksjoner som er deaktivert</p>
            <p>• oppdaterer innhold i hero, medlemskap, tilbakemeldinger, tjenester m.m.</p>
            <p>• bruker logo, video-URL og sosiale lenker du har satt.</p>
          </div>
        </section>
      </div>
    </div>
  </main>

  <script>
    const DEFAULT_ACCESS_PASS = "123456789";
    let ACCESS_PASS = DEFAULT_ACCESS_PASS;

    const DEFAULT_CONFIG = {
      access: {
        code: DEFAULT_ACCESS_PASS,
        adminName: "",
        adminEmail: "",
        adminPhone: ""
      },
      global: {
        logoUrl: "https://setaei.com/Fjolsen/Liggende-M%E2%94%9C%E2%95%95rk.png",
        youtubeUrl: "https://youtu.be/8EgRIkmvmtM?feature=shared",
        socials: {
          twitch: "https://www.twitch.tv/FjOlsenFN",
          tiktok: "https://www.tiktok.com/@fjolsenbanden",
          discord: "https://discord.gg/CbvBPHzg4D",
          youtube: "https://youtube.com/@fjolsenbanden",
          instagram: "https://www.instagram.com/fjolsenbanden"
        },
        vipps: {
          msn: "",
          clientId: "",
          clientSecret: "",
          subscriptionKey: "",
          enabled: false
        }
      },
      sections: {
        hero: {
          enabled: true,
          pillText: "Velkommen",
          sectionText:
            "En trygg arena for familier som elsker gaming, med fellesskap, premier og kreativitet i sentrum.",
          button1Label: "Bli medlem",
          button1Href: "#membership",
          button2Label: "Les mer",
          button2Href: "#about",
          heroImageUrl: "img/fjolsen-card.png",
          heroImageCaption: "Minecraft-inspirert versjon av apen i FjOlsen-logoen.",
          title: "",
          subtitle: ""
        },
        community: {
          enabled: true,
          title: "FjOlsenbanden – et community i vekst!",
          subtitle:
            "FjOlsenbanden har allerede over 10 000 følgere på tvers av våre kanaler og over 2600 medlemmer i Discord! Følg oss for å få med deg alle våre nyheter, det kan være unike events på de forskjellige kanalene."
        },
        julekalender: {
          enabled: true,
          pillText: "ÅRETS JULEKALENDER",
          title: "Vinn premier til verdi av over 10 000 kroner!",
          subtitle:
            "Meld deg på årets julekalender før 1. desember og få 10 lodd ekstra i den store giveaway 25. desember!",
          button: {
            label: "Meld deg på julekalenderen",
            href: "https://fjolsenbanden.julekalender.no/"
          },
          imageUrl: "https://setaei.com/Fjolsen/julekal.png"
        },
        about: {
          enabled: true,
          title: "Hva er FjOlsenbanden?",
          subtitle: "Norges mest inkluderende gaming-community for hele familien."
        },
        video: {
          enabled: true,
          title: "Hvem er FjOlsen?",
          subtitle: "FjOlsenFN – familievennlig streamer og grunnlegger av FjOlsenbanden."
        },
        feedback: {
          enabled: true,
          title: "Tilbakemeldinger fra FjOlsenbanden",
          subtitle: "Takk til alle som sender flotte tilbakemeldinger til oss i FjOlsenbanden!",
          items: [
            {
              quote:
                "«Tusen takk for at jeg har fått muligheten til å spille hos FJOlsenbanden.\nKan ikke takke nok for alt du har gjort for meg og alle andre. Tusen takk! <3\nTror ikke du vet hvor mye jeg setter pris på dette. Du har vært hele grunnen\ntil at jeg har blitt enda nærmere noen i real life venner. Tusen tusen takk for\ndet <3»",
              name: "Filip, medlem"
            },
            {
              quote:
                "«Du fortjener det mann! Du er så super streamer og den personen som\nsetter et smil på alle som kommer inn. Jeg som er syk ble glad med\nengang jeg kom inn.»",
              name: "Borkærn, medlem"
            },
            {
              quote:
                "«Tusen takk for alt du gjør for barn og ungdom som digger Fortnite – og for at du\nholder strenge og trygge rammer. Du skaper stor underholdningsverdi også for\noss som ikke skjønner så mye av gamingverden! Du klarte å få barnet vårt til å\nglede seg til bursdagen sin og å skape et skikkelig lyspunkt i en ellers ganske\ntøff tilværelse. For det er vi foreldre (og storesøster) evig takknemlig.»",
              name: "Pernille & Terje, foreldre"
            },
            {
              quote:
                "«Du har så mye peil på how to, overflow barn! Veldig fint og observere\nhvordan iallfall KJ tjener på FJOlsen-events!! Og jeg kjenner en del som\nhadde hatt fullt utbytte av et pedagogisk opplegg i din regi! Respect.»",
              name: "Merethe, mamma"
            }
          ]
        },
        membership: {
          enabled: true,
          title: "Bli medlem i dag.",
          subtitle:
            "Det er helt gratis å bli medlem i FjOlsenbanden. Ved å bli medlem kan du vinne premier og delta i giveaways.",
          features: [
            {
              iconUrl: "img/icons/discord.svg",
              text: "Få medlemsrolle i Discord"
            },
            {
              iconUrl: "img/icons/trophy.svg",
              text: "Vinne premier i customs & giveaways"
            },
            {
              iconUrl: "https://setaei.com/Fjolsen/Love.png",
              text: "Prioritet i kø til konkurranser foran ikke-medlemmer"
            }
          ],
          buttonUnder18: {
            label: "Under 18 år",
            href: "https://forms.gle/sq4mUf7s6e6UY7R58"
          },
          buttonOver18: {
            label: "Over 18 år",
            href: "https://forms.gle/ZrbXCggnUY8FTT7t9"
          }
        },
        community: {
          enabled: true,
          title: "FjOlsenbanden – et community i vekst!",
          subtitle:
            "FjOlsenbanden har allerede over 10 000 følgere på tvers av våre kanaler og over 2600 medlemmer i Discord! Følg oss for å få med deg alle våre nyheter, det kan være unike events på de forskjellige kanalene."
        },
        partners: {
          enabled: true,
          title: "Våre samarbeidspartnere",
          subtitle:
            "Her er noen av våre samarbeidspartnere som har bidratt til å skape minneverdige øyeblikk i FjOlsenbanden!",
          logos: [
            {
              name: "Lenovo",
              url: "https://fjolsenbanden.setaei.com/assets/p-lenovo-zG8s0yqd.png"
            },
            {
              name: "Komplett",
              url: "https://fjolsenbanden.setaei.com/assets/p-komplett-Bpx7vYhC.png"
            },
            {
              name: "Samsung",
              url: "https://fjolsenbanden.setaei.com/assets/p-samsung-CTyK3nvK.png"
            },
            {
              name: "Kristiania",
              url: "https://fjolsenbanden.setaei.com/assets/p-kristiania-DmhQbukm.png"
            },
            {
              name: "Philips",
              url: "https://fjolsenbanden.setaei.com/assets/p-philips-B33Lb_3a.png"
            },
            {
              name: "Saily",
              url: "https://fjolsenbanden.setaei.com/assets/p-saily-D-MbpSdv.png"
            },
            {
              name: "NKI",
              url: "https://setaei.com/Fjolsen/partnere/P-nki.svg"
            },
            {
              name: "Trondheim Play",
              url: "https://fjolsenbanden.setaei.com/assets/p-trondheimplay-BQDD3bw9.png"
            }
          ]
        },
        services: {
          enabled: true,
          title: "Andre tilbud",
          subtitle: "FjOlsenbanden tilbyr mer enn bare streaming!",
          items: [
            {
              title: "FOREDRAG",
              text:
                "FjOlsen besøker skoler, idrettslag og e-sportklubber for å snakke om streaming, gaming-kultur og nettvett.",
              iconUrl: "https://setaei.com/Fjolsen/Sjokk.png"
            },
            {
              title: "EVENTS",
              text:
                "Vi arrangerer gaming-konkurranser for bedrifter, skoler og klubber – både digitalt og fysisk.",
              iconUrl: "https://setaei.com/Fjolsen/Penger.png"
            },
            {
              title: "UNBOXING",
              text:
                "FjOlsen lager profesjonelle unboxing-videoer av dine produkter som kan brukes i deres markedsføring og deles med vårt community.",
              iconUrl: "https://setaei.com/Fjolsen/Love.png"
            },
            {
              title: "STREAMER FOR HIRE",
              text:
                "Ønsker du at FjOlsen skal streame på vegne av din merkevare? Han er tilgjengelig for co-streams, produktlanseringer og kampanjer – der ditt budskap blir formidlet på en autentisk og engasjerende måte til tusenvis av følgere.",
              iconUrl: "https://setaei.com/Fjolsen/Glad%20tenner.png"
            }
          ]
        },
        contact: {
          enabled: true,
          title: "Kontakt oss",
          subtitle:
            "Har du spørsmål om medlemskap, samarbeid eller events? Send oss en melding så kommer vi tilbake til deg."
        },
        faq: {
          enabled: true,
          title: "Ofte stilte spørsmål",
          subtitle: ""
        }
      },
      sectionsOrder: [
        "hero",
        "community",
        "julekalender",
        "about",
        "video",
        "feedback",
        "membership",
        "partners",
        "services",
        "contact",
        "faq"
      ]
    };

    let WORKING_CONFIG = null;

    const SECTION_META = [
      { id: "hero",       label: "Hero / Velkommen",        tag: "Øverst på siden" },
      { id: "community",  label: "Community / SoMe",        tag: "Sosiale medier" },
      { id: "julekalender", label: "Julekalender",          tag: "Kampanje" },
      { id: "about",      label: "Om FjOlsenbanden",        tag: "Presentasjon" },
      { id: "video",      label: "Video / Hvem er FjOlsen", tag: "YouTube / intro" },
      { id: "feedback",   label: "Tilbakemeldinger",        tag: "Sitater fra medlemmer" },
      { id: "membership", label: "Medlemskap",              tag: "Bli medlem / CTA" },
      { id: "partners",   label: "Samarbeidspartnere",      tag: "Logoer / partnere" },
      { id: "services",   label: "Andre tjenester",         tag: "Foredrag / events" },
      { id: "contact",    label: "Kontakt",                 tag: "Kontaktskjema" },
      { id: "faq",        label: "FAQ",                     tag: "Ofte stilte spørsmål" }
    ];

    function deepClone(obj) {
      return JSON.parse(JSON.stringify(obj));
    }

    function normalizeSectionOrder(cfg) {
      const knownIds = SECTION_META.map((s) => s.id);
      const incoming = Array.isArray(cfg.sectionsOrder) ? cfg.sectionsOrder.filter((id) => knownIds.includes(id)) : [];
      const missing = knownIds.filter((id) => !incoming.includes(id));
      return [...incoming, ...missing];
    }

    function loadConfig() {
      try {
        const raw = localStorage.getItem("fjAdminConfig");
        if (!raw) return deepClone(DEFAULT_CONFIG);
        const parsed = JSON.parse(raw);
        const cfg = deepClone(DEFAULT_CONFIG);

        if (parsed.access) {
          cfg.access = { ...cfg.access, ...parsed.access };
          ACCESS_PASS = cfg.access.code || DEFAULT_ACCESS_PASS;
        }

        if (parsed.global) {
          cfg.global = {
            ...cfg.global,
            ...parsed.global,
            socials: {
              ...cfg.global.socials,
              ...(parsed.global.socials || {})
            }
          };
        }

        if (parsed.sections) {
          Object.keys(parsed.sections).forEach((id) => {
            if (!cfg.sections[id]) return;
            cfg.sections[id] = { ...cfg.sections[id], ...parsed.sections[id] };
          });
        }

        cfg.sectionsOrder = normalizeSectionOrder(parsed);

        return cfg;
      } catch (e) {
        console.warn("Klarte ikke å lese config, bruker default:", e);
        return deepClone(DEFAULT_CONFIG);
      }
    }

    function saveConfig(cfg) {
      localStorage.setItem("fjAdminConfig", JSON.stringify(cfg));
    }

    function renderStats(cfg) {
      const sections = Object.values(cfg.sections);
      const total = sections.length;
      const on = sections.filter((s) => s.enabled).length;
      const off = total - on;

      document.getElementById("stat-total").textContent = total;
      document.getElementById("stat-on").textContent = on;
      document.getElementById("stat-off").textContent = off;
    }

    function renderGlobalForm(cfg) {
      const g = cfg.global;

      document.getElementById("branding-logo").value = g.logoUrl || "";
      document.getElementById("branding-youtube").value = g.youtubeUrl || "";

      document.getElementById("social-twitch").value = g.socials.twitch || "";
      document.getElementById("social-tiktok").value = g.socials.tiktok || "";
      document.getElementById("social-discord").value = g.socials.discord || "";
      document.getElementById("social-youtube").value = g.socials.youtube || "";
      document.getElementById("social-instagram").value = g.socials.instagram || "";

      const vipps = g.vipps || {};
      document.getElementById("vipps-msn").value = vipps.msn || "";
      document.getElementById("vipps-client-id").value = vipps.clientId || "";
      document.getElementById("vipps-client-secret").value = vipps.clientSecret || "";
      document.getElementById("vipps-sub-key").value = vipps.subscriptionKey || "";
      document.getElementById("vipps-enabled").checked = Boolean(vipps.enabled);
      const vippsStatus = document.getElementById("vipps-status-message");
      if (vippsStatus) {
        vippsStatus.textContent = "";
        vippsStatus.classList.remove("status--ok", "status--error");
      }

      const access = cfg.access || {};
      document.getElementById("access-code").value = access.code || DEFAULT_ACCESS_PASS;
      document.getElementById("admin-name").value = access.adminName || "";
      document.getElementById("admin-email").value = access.adminEmail || "";
      document.getElementById("admin-phone").value = access.adminPhone || "";
    }

    function getOrderedMeta(cfg) {
      const orderIds = (cfg.sectionsOrder && cfg.sectionsOrder.length ? cfg.sectionsOrder : SECTION_META.map((s) => s.id)).filter(
        (id) => SECTION_META.some((meta) => meta.id === id)
      );
      const metaMap = new Map(SECTION_META.map((m) => [m.id, m]));
      const ordered = orderIds.map((id) => metaMap.get(id)).filter(Boolean);
      SECTION_META.forEach((meta) => {
        if (!orderIds.includes(meta.id)) ordered.push(meta);
      });
      return ordered;
    }

    function renderSectionsForm(cfg) {
      const container = document.getElementById("section-list");
      container.innerHTML = "";

      renderStats(cfg);

      const sectionMeta = getOrderedMeta(cfg);

      sectionMeta.forEach((meta) => {
        const sCfg = cfg.sections[meta.id] || { enabled: true, title: meta.label, subtitle: "" };
        const card = document.createElement("div");
        card.className = "section-card";
        card.dataset.sectionId = meta.id;
        card.id = `section-${meta.id}`;

        const headerHtml = `
          <div class="section-header-row">
            <div class="section-header-main">
              <div class="section-label">${meta.label}</div>
              <div class="section-id">ID: #${meta.id}</div>
            </div>
            <div style="display:flex; align-items:center; gap:0.75rem;">
              <span class="section-tag">${meta.tag}</span>
              <label class="toggle">
                <input type="checkbox" class="toggle-input" ${sCfg.enabled ? "checked" : ""} />
                <span>Vis på forsiden</span>
              </label>
            </div>
          </div>
        `;

        if (meta.id === "hero") {
          card.innerHTML = `
            ${headerHtml}
            <div class="field-group">
              <label>Tittel i pillen (f.eks. «Velkommen»)</label>
              <input type="text" class="hero-pill-input" value="${sCfg.pillText || ""}" />
            </div>

            <div class="field-group">
              <label>Seksjonstekst (under hovedoverskriften)</label>
              <textarea class="hero-sectiontext-input">${sCfg.sectionText || ""}</textarea>
            </div>

            <div class="subsection-title">Knapper</div>
            <div class="field-group">
              <label>Knapp 1 – tekst</label>
              <input type="text" class="hero-btn1-label-input" value="${sCfg.button1Label || ""}" />
            </div>
            <div class="field-group">
              <label>Knapp 1 – lenke (URL eller #anchor)</label>
              <input type="text" class="hero-btn1-href-input" value="${sCfg.button1Href || ""}" />
            </div>

            <div class="field-group">
              <label>Knapp 2 – tekst</label>
              <input type="text" class="hero-btn2-label-input" value="${sCfg.button2Label || ""}" />
            </div>
            <div class="field-group">
              <label>Knapp 2 – lenke (URL eller #anchor)</label>
              <input type="text" class="hero-btn2-href-input" value="${sCfg.button2Href || ""}" />
            </div>

            <div class="subsection-title">Hero-bilde</div>
            <div class="field-group">
              <label>Hero-bilde (URL)</label>
              <input type="text" class="hero-image-url-input" value="${sCfg.heroImageUrl || ""}" />
            </div>
            <div class="field-group">
              <label>Bildetekst (tekst under hero-bildet)</label>
              <textarea class="hero-image-caption-input">${sCfg.heroImageCaption || ""}</textarea>
            </div>
          `;
        } else if (meta.id === "julekalender") {
          card.innerHTML = `
            ${headerHtml}
            <div class="field-group">
              <label>Pill / label</label>
              <input type="text" class="jule-pill-input" value="${sCfg.pillText || ""}" />
            </div>
            <div class="field-group">
              <label>Tittel</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>
            <div class="field-group">
              <label>Ingress / brødtekst</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>
            <div class="field-group">
              <label>CTA-tekst</label>
              <input type="text" class="jule-btn-label" value="${(sCfg.button && sCfg.button.label) || ""}" />
            </div>
            <div class="field-group">
              <label>CTA-lenke</label>
              <input type="text" class="jule-btn-href" value="${(sCfg.button && sCfg.button.href) || ""}" />
            </div>
            <div class="field-group">
              <label>Bilde-URL</label>
              <input type="text" class="jule-image-url" value="${sCfg.imageUrl || ""}" />
            </div>
          `;
        } else if (meta.id === "feedback") {
          const items = sCfg.items || [];
          card.innerHTML = `
            ${headerHtml}

            <div class="field-group">
              <label>Tittel (H2 i seksjonen)</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>

            <div class="field-group">
              <label>Undertekst / subtitle</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>

            <div class="subsection-title">Tilbakemeldinger</div>
            <div class="feedback-grid-admin">
              ${items
                .map(
                  (item, index) => `
                  <div class="feedback-item-admin" data-feedback-index="${index}">
                    <div class="feedback-item-admin-header">Kort ${index + 1}</div>
                    <div class="field-group">
                      <label>Sitat</label>
                      <textarea class="feedback-quote-input">${item.quote || ""}</textarea>
                    </div>
                    <div class="field-group">
                      <label>Navn / rolle (f.eks. «Filip, medlem»)</label>
                      <input type="text" class="feedback-name-input" value="${item.name || ""}" />
                    </div>
                  </div>
                `
                )
                .join("")}
            </div>
          `;
        } else if (meta.id === "membership") {
          const features = sCfg.features || [];
          card.innerHTML = `
            ${headerHtml}

            <div class="field-group">
              <label>Tittel (H2 i seksjonen)</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>

            <div class="field-group">
              <label>Undertekst / subtitle</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>

            <div class="subsection-title">Medlemsfordeler</div>
            <div class="two-column-fields">
              ${features
                .map(
                  (feat, index) => `
                  <div class="field-group" data-feature-index="${index}">
                    <label>Fordel ${index + 1} – ikon-URL</label>
                    <input type="text" class="membership-feature-icon-input" value="${feat.iconUrl || ""}" />
                    <label>Fordel ${index + 1} – tekst</label>
                    <input type="text" class="membership-feature-text-input" value="${feat.text || ""}" />
                  </div>
                `
                )
                .join("")}
            </div>

            <div class="subsection-title">Knapper</div>
            <div class="field-inline">
              <div class="field-group">
                <label>Knapp «Under 18 år» – tekst</label>
                <input type="text" class="membership-btn-under-label" value="${(sCfg.buttonUnder18 && sCfg.buttonUnder18.label) || ""}" />
                <label>Lenke (URL eller Discord-invite)</label>
                <input type="text" class="membership-btn-under-href" value="${(sCfg.buttonUnder18 && sCfg.buttonUnder18.href) || ""}" />
              </div>
              <div class="field-group">
                <label>Knapp «Over 18 år» – tekst</label>
                <input type="text" class="membership-btn-over-label" value="${(sCfg.buttonOver18 && sCfg.buttonOver18.label) || ""}" />
                <label>Lenke (URL eller Discord-invite)</label>
                <input type="text" class="membership-btn-over-href" value="${(sCfg.buttonOver18 && sCfg.buttonOver18.href) || ""}" />
              </div>
            </div>
          `;
        } else if (meta.id === "services") {
          const items = sCfg.items || [];
          card.innerHTML = `
            ${headerHtml}

            <div class="field-group">
              <label>Tittel (H2 i seksjonen)</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>

            <div class="field-group">
              <label>Undertekst / subtitle</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>

            <div class="subsection-title">Tjenester</div>
            <div class="two-column-fields">
              ${items
                .map(
                  (item, index) => `
                  <div class="field-group" data-service-index="${index}">
                    <label>Tjeneste ${index + 1} – tittel</label>
                    <input type="text" class="service-title-input" value="${item.title || ""}" />
                    <label>Tjeneste ${index + 1} – tekst</label>
                    <textarea class="service-text-input">${item.text || ""}</textarea>
                    <label>Tjeneste ${index + 1} – ikon-URL</label>
                    <input type="text" class="service-icon-input" value="${item.iconUrl || ""}" />
                  </div>
                `
                )
                .join("")}
            </div>
          `;
        } else if (meta.id === "partners") {
          const logos = sCfg.logos || [];
          card.innerHTML = `
            ${headerHtml}

            <div class="field-group">
              <label>Tittel (H2 i seksjonen)</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>

            <div class="field-group">
              <label>Undertekst / subtitle</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>

            <div class="subsection-title">Partnerlogoer</div>
            <div class="two-column-fields">
              ${logos
                .map(
                  (logo, index) => `
                  <div class="field-group" data-partner-index="${index}">
                    <label>Partner ${index + 1} – navn</label>
                    <input type="text" class="partner-name-input" value="${logo.name || ""}" />
                    <label>Partner ${index + 1} – logo-URL</label>
                    <input type="text" class="partner-url-input" value="${logo.url || ""}" />
                  </div>
                `
                )
                .join("")}
            </div>
          `;
        } else {
          // standard: title + subtitle
          card.innerHTML = `
            ${headerHtml}

            <div class="field-group">
              <label>Tittel (H2 i seksjonen)</label>
              <input type="text" class="title-input" value="${sCfg.title || ""}" />
            </div>

            <div class="field-group">
              <label>Undertekst / subtitle</label>
              <textarea class="subtitle-input">${sCfg.subtitle || ""}</textarea>
            </div>
          `;
        }

        const toggleInput = card.querySelector(".toggle-input");
        if (toggleInput) {
          toggleInput.addEventListener("change", () => {
            cfg.sections[meta.id].enabled = toggleInput.checked;
            renderStats(cfg);
            const sorterToggle = document.querySelector(
              `#section-order-list .section-sorter-item[data-section-id="${meta.id}"] .order-toggle`
            );
            if (sorterToggle) sorterToggle.checked = toggleInput.checked;
          });
        }

        container.appendChild(card);
      });
    }

    function renderSectionOrderList(cfg) {
      const list = document.getElementById("section-order-list");
      if (!list) return;

      list.innerHTML = "";
      const ordered = getOrderedMeta(cfg);

      ordered.forEach((meta) => {
        const li = document.createElement("li");
        li.className = "section-sorter-item";
        li.dataset.sectionId = meta.id;
        li.draggable = true;

        li.innerHTML = `
          <span class="sorter-handle" aria-hidden="true">⋮⋮</span>
          <div>
            <div class="sorter-name">${meta.label}</div>
            <div class="sorter-tag">#${meta.id}</div>
          </div>
          <label class="toggle">
            <input type="checkbox" class="order-toggle" ${cfg.sections[meta.id]?.enabled !== false ? "checked" : ""} />
            <span>På</span>
          </label>
        `;

        const toggle = li.querySelector(".order-toggle");
        toggle.addEventListener("change", () => {
          if (cfg.sections[meta.id]) {
            cfg.sections[meta.id].enabled = toggle.checked;
          }
          const cardToggle = document.querySelector(`#section-${meta.id} .toggle-input`);
          if (cardToggle) {
            cardToggle.checked = toggle.checked;
          }
          renderStats(cfg);
        });

        list.appendChild(li);
      });

      let draggedItem = null;

      const updateOrder = () => {
        const ids = Array.from(list.querySelectorAll(".section-sorter-item")).map((item) => item.dataset.sectionId);
        cfg.sectionsOrder = ids;
      };

      list.addEventListener("dragstart", (e) => {
        const item = e.target.closest(".section-sorter-item");
        if (!item) return;
        draggedItem = item;
        item.classList.add("dragging");
        e.dataTransfer.effectAllowed = "move";
      });

      list.addEventListener("dragover", (e) => {
        e.preventDefault();
        const item = e.target.closest(".section-sorter-item");
        if (!item || item === draggedItem) return;

        const rect = item.getBoundingClientRect();
        const before = e.clientY < rect.top + rect.height / 2;
        if (before) {
          list.insertBefore(draggedItem, item);
        } else {
          list.insertBefore(draggedItem, item.nextSibling);
        }
      });

      list.addEventListener("drop", (e) => {
        e.preventDefault();
        updateOrder();
      });

      list.addEventListener("dragend", () => {
        if (draggedItem) draggedItem.classList.remove("dragging");
        updateOrder();
        draggedItem = null;
      });
    }

    function collectConfigFromForm() {
      const cfg = deepClone(DEFAULT_CONFIG);

      const orderItems = document.querySelectorAll("#section-order-list .section-sorter-item");
      const enabledFromSorter = {};
      cfg.sectionsOrder = Array.from(orderItems)
        .map((item) => {
          const id = item.dataset.sectionId;
          const toggle = item.querySelector(".order-toggle");
          enabledFromSorter[id] = toggle ? toggle.checked : true;
          return id;
        })
        .filter((id) => !!cfg.sections[id]);

      const cards = document.querySelectorAll(".section-card");
      cards.forEach((card) => {
        const id = card.dataset.sectionId;
        const enabled =
          Object.prototype.hasOwnProperty.call(enabledFromSorter, id) && enabledFromSorter[id] !== undefined
            ? enabledFromSorter[id]
            : card.querySelector(".toggle-input").checked;

        if (id === "hero") {
          const pillText = card.querySelector(".hero-pill-input").value.trim();
          const sectionText = card.querySelector(".hero-sectiontext-input").value.trim();
          const btn1Label = card.querySelector(".hero-btn1-label-input").value.trim();
          const btn1Href = card.querySelector(".hero-btn1-href-input").value.trim();
          const btn2Label = card.querySelector(".hero-btn2-label-input").value.trim();
          const btn2Href = card.querySelector(".hero-btn2-href-input").value.trim();
          const imgUrl = card.querySelector(".hero-image-url-input").value.trim();
          const imgCaption = card.querySelector(".hero-image-caption-input").value.trim();

          cfg.sections.hero = {
            ...cfg.sections.hero,
            enabled,
            pillText: pillText || cfg.sections.hero.pillText,
            sectionText: sectionText || cfg.sections.hero.sectionText,
            button1Label: btn1Label || cfg.sections.hero.button1Label,
            button1Href: btn1Href || cfg.sections.hero.button1Href,
            button2Label: btn2Label || cfg.sections.hero.button2Label,
            button2Href: btn2Href || cfg.sections.hero.button2Href,
            heroImageUrl: imgUrl || cfg.sections.hero.heroImageUrl,
            heroImageCaption: imgCaption || cfg.sections.hero.heroImageCaption
          };
        } else if (id === "julekalender") {
          const pillText = card.querySelector(".jule-pill-input").value.trim();
          const title = card.querySelector(".title-input").value.trim();
          const subtitle = card.querySelector(".subtitle-input").value.trim();
          const btnLabel = card.querySelector(".jule-btn-label").value.trim();
          const btnHref = card.querySelector(".jule-btn-href").value.trim();
          const imageUrl = card.querySelector(".jule-image-url").value.trim();

          cfg.sections.julekalender = {
            ...cfg.sections.julekalender,
            enabled,
            pillText: pillText || cfg.sections.julekalender.pillText,
            title: title || cfg.sections.julekalender.title,
            subtitle: subtitle || cfg.sections.julekalender.subtitle,
            button: {
              label: btnLabel || cfg.sections.julekalender.button.label,
              href: btnHref || cfg.sections.julekalender.button.href
            },
            imageUrl: imageUrl || cfg.sections.julekalender.imageUrl
          };
        } else if (id === "feedback") {
          const titleInput = card.querySelector(".title-input");
          const subtitleInput = card.querySelector(".subtitle-input");
          const quoteBlocks = card.querySelectorAll(".feedback-item-admin");

          const items = [];
          quoteBlocks.forEach((block) => {
            const quote = block.querySelector(".feedback-quote-input").value.trim();
            const name = block.querySelector(".feedback-name-input").value.trim();
            items.push({ quote, name });
          });

          cfg.sections.feedback = {
            ...cfg.sections.feedback,
            enabled,
            title: (titleInput && titleInput.value.trim()) || cfg.sections.feedback.title,
            subtitle: (subtitleInput && subtitleInput.value.trim()) || "",
            items
          };
        } else if (id === "membership") {
          const titleInput = card.querySelector(".title-input");
          const subtitleInput = card.querySelector(".subtitle-input");

          const featureGroups = card.querySelectorAll("[data-feature-index]");
          const features = [];
          featureGroups.forEach((fg) => {
            const icon = fg.querySelector(".membership-feature-icon-input").value.trim();
            const text = fg.querySelector(".membership-feature-text-input").value.trim();
            features.push({
              iconUrl: icon || "",
              text: text || ""
            });
          });

          const underLabel = card.querySelector(".membership-btn-under-label").value.trim();
          const underHref = card.querySelector(".membership-btn-under-href").value.trim();
          const overLabel = card.querySelector(".membership-btn-over-label").value.trim();
          const overHref = card.querySelector(".membership-btn-over-href").value.trim();

          cfg.sections.membership = {
            ...cfg.sections.membership,
            enabled,
            title: (titleInput && titleInput.value.trim()) || cfg.sections.membership.title,
            subtitle: (subtitleInput && subtitleInput.value.trim()) || cfg.sections.membership.subtitle,
            features: features.length ? features : cfg.sections.membership.features,
            buttonUnder18: {
              label: underLabel || cfg.sections.membership.buttonUnder18.label,
              href: underHref || cfg.sections.membership.buttonUnder18.href
            },
            buttonOver18: {
              label: overLabel || cfg.sections.membership.buttonOver18.label,
              href: overHref || cfg.sections.membership.buttonOver18.href
            }
          };
        } else if (id === "services") {
          const titleInput = card.querySelector(".title-input");
          const subtitleInput = card.querySelector(".subtitle-input");

          const serviceGroups = card.querySelectorAll("[data-service-index]");
          const items = [];
          serviceGroups.forEach((sg) => {
            const sTitle = sg.querySelector(".service-title-input").value.trim();
            const sText = sg.querySelector(".service-text-input").value.trim();
            const sIcon = sg.querySelector(".service-icon-input").value.trim();
            items.push({
              title: sTitle || "",
              text: sText || "",
              iconUrl: sIcon || ""
            });
          });

          cfg.sections.services = {
            ...cfg.sections.services,
            enabled,
            title: (titleInput && titleInput.value.trim()) || cfg.sections.services.title,
            subtitle: (subtitleInput && subtitleInput.value.trim()) || cfg.sections.services.subtitle,
            items: items.length ? items : cfg.sections.services.items
          };
        } else if (id === "partners") {
          const titleInput = card.querySelector(".title-input");
          const subtitleInput = card.querySelector(".subtitle-input");

          const partnerGroups = card.querySelectorAll("[data-partner-index]");
          const logos = [];
          partnerGroups.forEach((pg) => {
            const name = pg.querySelector(".partner-name-input").value.trim();
            const url = pg.querySelector(".partner-url-input").value.trim();
            logos.push({
              name,
              url
            });
          });

          cfg.sections.partners = {
            ...cfg.sections.partners,
            enabled,
            title: (titleInput && titleInput.value.trim()) || cfg.sections.partners.title,
            subtitle: (subtitleInput && subtitleInput.value.trim()) || cfg.sections.partners.subtitle,
            logos: logos.length ? logos : cfg.sections.partners.logos
          };
        } else {
          const titleInput = card.querySelector(".title-input");
          const subtitleInput = card.querySelector(".subtitle-input");

          cfg.sections[id] = {
            ...cfg.sections[id],
            enabled,
            title: (titleInput && titleInput.value.trim()) || cfg.sections[id].title,
            subtitle: subtitleInput ? subtitleInput.value.trim() : cfg.sections[id].subtitle
          };
        }
      });

      const g = cfg.global;
      const logo = document.getElementById("branding-logo").value.trim();
      const yt = document.getElementById("branding-youtube").value.trim();

      if (logo) g.logoUrl = logo;
      if (yt) g.youtubeUrl = yt;

      g.socials.twitch = document.getElementById("social-twitch").value.trim() || g.socials.twitch;
      g.socials.tiktok = document.getElementById("social-tiktok").value.trim() || g.socials.tiktok;
      g.socials.discord = document.getElementById("social-discord").value.trim() || g.socials.discord;
      g.socials.youtube = document.getElementById("social-youtube").value.trim() || g.socials.youtube;
      g.socials.instagram = document.getElementById("social-instagram").value.trim() || g.socials.instagram;

      const vippsDefaults = g.vipps || {};
      g.vipps = {
        ...vippsDefaults,
        msn: document.getElementById("vipps-msn").value.trim() || vippsDefaults.msn || "",
        clientId: document.getElementById("vipps-client-id").value.trim() || vippsDefaults.clientId || "",
        clientSecret:
          document.getElementById("vipps-client-secret").value.trim() || vippsDefaults.clientSecret || "",
        subscriptionKey: document.getElementById("vipps-sub-key").value.trim() || vippsDefaults.subscriptionKey || "",
        enabled: document.getElementById("vipps-enabled").checked
      };

      cfg.access = {
        ...cfg.access,
        code: document.getElementById("access-code").value.trim() || DEFAULT_ACCESS_PASS,
        adminName: document.getElementById("admin-name").value.trim(),
        adminEmail: document.getElementById("admin-email").value.trim(),
        adminPhone: document.getElementById("admin-phone").value.trim()
      };

      ACCESS_PASS = cfg.access.code;

      return cfg;
    }

    function setStatus(msg, type = "") {
      const el = document.getElementById("status-msg");
      el.textContent = msg;
      el.classList.remove("status--ok", "status--error");
      if (type === "ok") el.classList.add("status--ok");
      if (type === "error") el.classList.add("status--error");
    }

    function setupAuth() {
      const overlay = document.getElementById("auth-overlay");
      const form = document.getElementById("auth-form");
      const input = document.getElementById("access-pass");
      const error = document.getElementById("auth-error");
      const app = document.getElementById("app");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const value = input.value.trim();
        if (value === ACCESS_PASS) {
          overlay.style.display = "none";
          app.classList.add("app--ready");
          input.value = "";
          error.textContent = "";
        } else {
          error.textContent = "Feil access pass. Prøv igjen.";
          input.focus();
          input.select();
        }
      });

      setTimeout(() => input.focus(), 50);
    }

    function setupNav() {
      const buttons = document.querySelectorAll(".admin-nav-btn");
      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const targetId = btn.dataset.target;
          const target = document.getElementById(targetId);
          if (target) {
            target.scrollIntoView({ behavior: "smooth", block: "start" });
          }
          buttons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      WORKING_CONFIG = loadConfig();
      ACCESS_PASS = (WORKING_CONFIG.access && WORKING_CONFIG.access.code) || DEFAULT_ACCESS_PASS;

      setupAuth();

      renderSectionsForm(WORKING_CONFIG);
      renderSectionOrderList(WORKING_CONFIG);
      renderGlobalForm(WORKING_CONFIG);
      setupNav();

      document.getElementById("save-btn").addEventListener("click", () => {
        try {
          const newCfg = collectConfigFromForm();
          saveConfig(newCfg);
          WORKING_CONFIG = newCfg;
          renderStats(newCfg);
          renderSectionOrderList(newCfg);
          setStatus("Lagret! Oppdater forsiden for å se endringene.", "ok");
        } catch (e) {
          console.error(e);
          setStatus("Noe gikk galt ved lagring.", "error");
        }
      });

        const vippsSaveBtn = document.getElementById("vipps-save-settings");
        const vippsStatus = document.getElementById("vipps-status-message");
        if (vippsSaveBtn) {
          vippsSaveBtn.addEventListener("click", () => {
            try {
              const newCfg = collectConfigFromForm();
              saveConfig(newCfg);
              WORKING_CONFIG = newCfg;
              renderStats(newCfg);
              renderSectionOrderList(newCfg);
              setStatus("Lagret! Oppdater forsiden for å se endringene.", "ok");
              if (vippsStatus) {
                vippsStatus.textContent = "Vipps-innstillinger lagret.";
                vippsStatus.classList.remove("status--error");
                vippsStatus.classList.add("status--ok");
            }
          } catch (e) {
            console.error(e);
            if (vippsStatus) {
              vippsStatus.textContent = "Noe gikk galt ved lagring av Vipps.";
              vippsStatus.classList.remove("status--ok");
              vippsStatus.classList.add("status--error");
            }
          }
        });
      }

      document.getElementById("reset-btn").addEventListener("click", () => {
        saveConfig(DEFAULT_CONFIG);
        const fresh = loadConfig();
        WORKING_CONFIG = fresh;
        renderSectionsForm(fresh);
        renderSectionOrderList(fresh);
        renderGlobalForm(fresh);
        setupNav();
        setStatus("Tilbakestilt til standardoppsett.", "ok");
      });
    });
  </script>
</body>
</html>
